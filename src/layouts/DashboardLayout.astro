---
import BaseLayout from "./BaseLayout.astro";

interface Props {
	title?: string;
	activeNav?: string;
}

const { title = "å·¥ä½œå°", activeNav = "" } = Astro.props;
const user = Astro.locals.user;

if (!user) {
	return Astro.redirect("/login");
}

const roleLabels: Record<string, string> = {
	author: "ä½œè€…",
	editor: "ç¼–è¾‘",
	reviewer: "å®¡ç¨¿äºº",
};

const authorNav = [
	{ href: "/author", label: "æˆ‘çš„ç¨¿ä»¶", icon: "ğŸ“„" },
	{ href: "/author/submit", label: "æŠ•é€’æ–°ç¨¿ä»¶", icon: "âœï¸" },
	{ href: "/author/profile", label: "ä¸ªäººèµ„æ–™", icon: "ğŸ‘¤" },
];

const editorNav = [
	{ href: "/editor", label: "ç¨¿ä»¶æ€»è§ˆ", icon: "ğŸ“‹" },
	{ href: "/editor/board", label: "ç¼–å§”ç®¡ç†", icon: "ğŸ‘¥" },
	{ href: "/editor/reviewers", label: "å®¡ç¨¿äººç®¡ç†", icon: "ğŸ”" },
	{ href: "/editor/profile", label: "ä¸ªäººèµ„æ–™", icon: "ğŸ‘¤" },
];

const reviewerNav = [
	{ href: "/reviewer", label: "å¾…å®¡ç¨¿ä»¶", icon: "ğŸ“" },
	{ href: "/reviewer/history", label: "å®¡ç¨¿å†å²", icon: "ğŸ“š" },
	{ href: "/reviewer/profile", label: "ä¸ªäººèµ„æ–™", icon: "ğŸ‘¤" },
];

const navItems =
	user.role === "author"
		? authorNav
		: user.role === "editor"
			? editorNav
			: reviewerNav;
---

<BaseLayout title={`${title} - ç„å­¦å‰æ²¿æœŸåˆŠç¾¤`}>
	<div class="dashboard-layout">
		<aside class="dashboard-sidebar">
			<div class="sidebar-user">
				<div class="sidebar-user-name">{user.name}</div>
				<div class="sidebar-user-role">
					{roleLabels[user.role] || user.role}
				</div>
			</div>

			<nav>
				{navItems.map((item) => (
					<a
						href={item.href}
						class={`sidebar-nav-item${activeNav === item.href ? " active" : ""}`}
					>
						<span>{item.icon}</span>
						{item.label}
					</a>
				))}

				<div class="sidebar-nav-section">è´¦æˆ·</div>
				<a href="/" class="sidebar-nav-item">
					<span>ğŸ </span>è¿”å›é¦–é¡µ
				</a>
				<a href="/api/auth/logout" class="sidebar-nav-item">
					<span>ğŸšª</span>é€€å‡ºç™»å½•
				</a>
			</nav>
		</aside>

		<div class="dashboard-main">
			<slot />
		</div>
	</div>
</BaseLayout>
