---
import BaseLayout from "./BaseLayout.astro";

interface Props {
	title?: string;
	activeNav?: string;
}

const { title = "Dashboard", activeNav = "" } = Astro.props;
const user = Astro.locals.user;

if (!user) {
	return Astro.redirect("/login");
}

const roleLabels: Record<string, string> = {
	author: "Author",
	editor: "Editor",
	reviewer: "Reviewer",
};

const authorNav = [
	{ href: "/author", label: "My Manuscripts", icon: "ğŸ“„" },
	{ href: "/author/submit", label: "Submit Manuscript", icon: "âœï¸" },
	{ href: "/author/profile", label: "Profile", icon: "ğŸ‘¤" },
];

const editorNav = [
	{ href: "/editor", label: "Editorial Dashboard", icon: "ğŸ“‹" },
	{ href: "/editor/board", label: "Editorial Board", icon: "ğŸ‘¥" },
	{ href: "/editor/reviewers", label: "Reviewers", icon: "ğŸ”" },
	{ href: "/editor/profile", label: "Profile", icon: "ğŸ‘¤" },
];

const reviewerNav = [
	{ href: "/reviewer", label: "Assigned Reviews", icon: "ğŸ“" },
	{ href: "/reviewer/history", label: "Review History", icon: "ğŸ“š" },
	{ href: "/reviewer/profile", label: "Profile", icon: "ğŸ‘¤" },
];

const navItems =
	user.role === "author"
		? authorNav
		: user.role === "editor"
			? editorNav
			: reviewerNav;
---

<BaseLayout title={`${title} - Rubbish Publishing Group`}>
	<div class="dashboard-layout">
		<aside class="dashboard-sidebar">
			<div class="sidebar-user">
				<div class="sidebar-user-name">{user.name}</div>
				<div class="sidebar-user-role">
					{roleLabels[user.role] || user.role}
				</div>
			</div>

			<nav>
				{navItems.map((item) => (
					<a
						href={item.href}
						class={`sidebar-nav-item${activeNav === item.href ? " active" : ""}`}
					>
						<span>{item.icon}</span>
						{item.label}
					</a>
				))}

				<div class="sidebar-nav-section">Account</div>
				<a href="/" class="sidebar-nav-item">
					<span>ğŸ </span>Home
				</a>
				<a href="/api/auth/logout" class="sidebar-nav-item">
					<span>ğŸšª</span>Sign Out
				</a>
			</nav>
		</aside>

		<div class="dashboard-main">
			<slot />
		</div>
	</div>
</BaseLayout>
