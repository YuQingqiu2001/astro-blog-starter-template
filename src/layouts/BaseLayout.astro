---
import "../styles/global.css";
import { journals } from "../data/journals";

interface Props {
	title?: string;
	description?: string;
	noHeader?: boolean;
	noFooter?: boolean;
}

const {
	title = "Rubbish Publishing Group",
	description = "The world's leading publisher of academically-formatted research of questionable merit. RPG: Where every paper gets published eventually.",
	noHeader = false,
	noFooter = false,
} = Astro.props;

const user = Astro.locals.user;
const pathname = new URL(Astro.request.url).pathname;

const subJournals = journals.filter((j) => !j.isMain);
---

<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>{title}</title>
	<meta name="description" content={description} />
	<link rel="icon" type="image/jpeg" href="/images/articlelogo.jpg" />
	<meta property="og:title" content={title} />
	<meta property="og:description" content={description} />
	<meta property="og:type" content="website" />
</head>
<body>
	{!noHeader && (
		<header class="site-header">
			<!-- Top bar -->
			<div class="header-top">
				<div class="container">
					<div class="header-top-inner">
						<div class="header-top-links">
							<a href="/journals">All Journals</a>
							<a href="/join-editorial-board">Join Editorial Board</a>
							<a href="/about">About RPG</a>
						</div>
						<div class="header-top-links">
							{user ? (
								<>
									<a href={`/${user.role}`}>My Dashboard</a>
									<a href="/api/auth/logout">Logout</a>
								</>
							) : (
								<>
									<a href="/login">Login</a>
									<a href="/register">Register</a>
								</>
							)}
						</div>
					</div>
				</div>
			</div>

			<!-- Main header -->
			<div class="header-main">
				<div class="container">
					<div class="header-main-inner">
						<a href="/" class="site-logo">
							<img src="/images/RPG.png" alt="RPG" class="logo-img" style="height:48px;width:auto;object-fit:contain;flex-shrink:0;" />
							<div class="logo-text">
								<span class="logo-zh">Rubbish Publishing Group</span>
								<span class="logo-en">Where Science Goes to Die · Est. 2024</span>
							</div>
						</a>
						<div class="header-divider"></div>
						<span class="header-tagline">Advancing the frontiers of academic mediocrity</span>
						<div class="header-actions">
							<a href="/join-editorial-board" class="btn-join">Join Editorial Board</a>
							{user ? (
								<a href={`/${user.role}`} class="btn-login">{user.name}</a>
							) : (
								<a href="/login" class="btn-login">Login / Submit</a>
							)}
						</div>
					</div>
				</div>
			</div>

			<!-- Main navigation -->
			<nav class="main-nav">
				<div class="container">
					<div class="main-nav-inner">
						<a href="/" class={`nav-link${pathname === "/" ? " active" : ""}`}>Home</a>
						<a href="/journals" class={`nav-link${pathname.startsWith("/journals") ? " active" : ""}`}>All Journals</a>
						{subJournals.slice(0, 4).map((j) => (
							<a
								href={`/journals/${j.slug}`}
								class={`nav-link${pathname === `/journals/${j.slug}` ? " active" : ""}`}
							>
								{j.name}
							</a>
						))}
						<a href="/search" class={`nav-link${pathname === "/search" ? " active" : ""}`}>Search</a>
					</div>
				</div>
			</nav>
		</header>
	)}

	<main>
		<slot />
	</main>

	{!noFooter && (
		<footer class="site-footer">
			<div class="container">
				<div class="footer-main">
					<div class="footer-brand">
						<div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.75rem;">
							<img src="/images/RPG.png" alt="RPG" style="height:40px;width:auto;object-fit:contain;" />
							<h3 style="margin:0;">Rubbish Publishing Group</h3>
						</div>
						<p>
							Committed to publishing the most academically rigorous research of the least practical value.
							We believe every idea deserves to be published, regardless of merit, reproducibility, or basic logical coherence.
						</p>
					</div>
					<div class="footer-col">
						<h4>Journals</h4>
						<ul>
							{journals.slice(0, 10).map((j) => (
								<li><a href={`/journals/${j.slug}`}>{j.name}</a></li>
							))}
							{journals.length > 10 && (
								<li><a href="/journals">+ {journals.length - 10} more journals</a></li>
							)}
						</ul>
					</div>
					<div class="footer-col">
						<h4>Author Services</h4>
						<ul>
							<li><a href="/register">Create Account</a></li>
							<li><a href="/author/submit">Submit Manuscript</a></li>
							<li><a href="/author">Track Submissions</a></li>
							<li><a href="/join-editorial-board">Join Editorial Board</a></li>
						</ul>
					</div>
					<div class="footer-col">
						<h4>About</h4>
						<ul>
							<li><a href="/about">About RPG</a></li>
							<li><a href="/contact">Contact Us</a></li>
							<li><a href="/ethics">Publication Ethics</a></li>
							<li><a href="/open-access">Open Access</a></li>
						</ul>
					</div>
				</div>
				<div class="footer-bottom">
					<span>© {new Date().getFullYear()} Rubbish Publishing Group. All rights reserved.</span>
					<span>Powered by Astro + Cloudflare Workers</span>
				</div>
			</div>
		</footer>
	)}
</body>
</html>
