---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { journals, mainJournal, subJournals } from "../../data/journals";

const q = new URL(Astro.request.url).searchParams.get("q") || "";
const filteredJournals = q
	? journals.filter(
			(j) =>
				j.name.includes(q) ||
				j.nameEn.toLowerCase().includes(q.toLowerCase()) ||
				j.field.includes(q) ||
				j.issn.includes(q)
		)
	: journals;
---

<BaseLayout title="Journal Catalog - Rubbish Publishing Group">
	<div class="featured-section" style="padding: 2rem 0;">
		<div class="container">
			<h1 style="color: #fff; font-size: 1.75rem; margin-bottom: 0.5rem;">Journal Catalog</h1>
			<p style="color: rgba(255,255,255,0.65); font-size: 0.9rem;">
				Rubbish Publishing Group operates {journals.length} academic journals spanning general, natural sciences, social sciences, and other fields of rubbish research.
			</p>
		</div>
	</div>

	<div class="page-content">
		<div class="container">
			<!-- Search -->
			<form method="get" action="/journals" class="search-bar" style="margin-bottom: 2rem;">
				<input
					type="text"
					name="q"
					class="search-input"
					value={q}
					placeholder="Search journal name, field, or ISSN..."
				/>
				<button type="submit" class="search-btn">Search</button>
			</form>

			{q && (
				<p class="text-muted" style="margin-bottom: 1.5rem;">
					Search results for "<strong>{q}</strong>": {filteredJournals.length} journals found
					<a href="/journals" style="margin-left: 0.5rem; font-size: 0.85rem;">Clear</a>
				</p>
			)}

			{/* Main journal */}
			{!q || filteredJournals.some((j) => j.isMain) ? (
				<div style="margin-bottom: 2.5rem;">
					<h2 class="section-title" style="margin-bottom: 1.25rem;">Flagship Journal</h2>
					<a href={`/journals/${mainJournal.slug}`} class="journal-card-main">
						<div class="journal-card-main-cover" style={mainJournal.coverImage ? "padding:0;overflow:hidden;" : ""}>
							{mainJournal.coverImage ? (
								<img src={mainJournal.coverImage} alt={mainJournal.name} style="width:100%;height:100%;object-fit:cover;" />
							) : (
								<>
									<span class="journal-card-main-badge">Flagship Journal</span>
									<div class="journal-card-main-title">{mainJournal.name}</div>
									<div class="journal-card-main-title-en">{mainJournal.nameEn}</div>
									<div class="journal-card-main-stats">
										<div class="stat-item">
											<div class="stat-value">{mainJournal.impactFactor}</div>
											<div class="stat-label">Impact Factor</div>
										</div>
										<div class="stat-item">
											<div class="stat-value">2024</div>
											<div class="stat-label">Founded</div>
										</div>
										<div class="stat-item">
											<div class="stat-value">{journals.length}</div>
											<div class="stat-label">Journals</div>
										</div>
									</div>
								</>
							)}
							{mainJournal.coverImage && (
								<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to right,rgba(0,0,0,0.5) 0%,rgba(0,0,0,0) 60%);pointer-events:none;"></div>
							)}
						</div>
						<div class="journal-card-main-content">
							<div>
								<span class="journal-card-main-badge" style="display:inline-block;margin-bottom:0.5rem;">Flagship Journal</span>
								<p class="journal-card-main-issn">ISSN: {mainJournal.issn} · IF: {mainJournal.impactFactor}</p>
								<p class="journal-card-main-desc">{mainJournal.description}</p>
							</div>
							<span class="btn-view-journal">View Journal →</span>
						</div>
					</a>
				</div>
			) : null}

			{/* Sub journals */}
			<div>
				<h2 class="section-title" style="margin-bottom: 1.25rem;">All Journals</h2>
				{filteredJournals.filter((j) => !j.isMain).length === 0 ? (
					<div class="alert alert-info">No journals found matching your search.</div>
				) : (
					<div class="grid-3">
						{filteredJournals
							.filter((j) => !j.isMain)
							.map((journal) => (
								<a href={`/journals/${journal.slug}`} class="journal-card">
									{journal.coverImage ? (
										<div style={`height:140px;overflow:hidden;border-radius:6px 6px 0 0;position:relative;`}>
											<img src={journal.coverImage} alt={journal.name} style="width:100%;height:100%;object-fit:cover;" />
											<div style={`position:absolute;bottom:0;left:0;right:0;height:4px;background:${journal.color};`}></div>
										</div>
									) : (
										<div class="journal-card-stripe" style={`background: ${journal.color}`}></div>
									)}
									<div class="journal-card-body">
										<div class="journal-card-name">{journal.name}</div>
										<p class="journal-card-desc">{journal.description}</p>
										<div class="journal-card-meta">
											<div class="journal-card-if">
												IF: <strong>{journal.impactFactor}</strong>
												<span style="margin-left: 0.75rem; color: var(--text-light);">ISSN: {journal.issn}</span>
											</div>
											<span class="journal-card-field">{journal.field}</span>
										</div>
									</div>
								</a>
							))}
					</div>
				)}
			</div>
		</div>
	</div>
</BaseLayout>
