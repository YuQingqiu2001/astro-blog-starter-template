---
import BaseLayout from "../layouts/BaseLayout.astro";

const params = new URL(Astro.request.url).searchParams;
const token = params.get("token") || "";
const error = params.get("error");
---

<BaseLayout title="Reset Password - Rubbish Publishing Group">
	<div class="auth-page">
		<div class="auth-card">
			<h1>Reset Password</h1>
			<p class="auth-subtitle">Set a new password for your account.</p>

			{error && (
				<div class="alert alert-error">
					{error === "invalid_or_expired" ? "This reset link is invalid or expired." :
					 error === "weak_password" ? "Password must be at least 8 characters." :
					 error === "password_mismatch" ? "Passwords do not match." :
					 error === "service_unavailable" ? "Password reset is currently unavailable." :
					 "Unable to reset password. Please try again."}
				</div>
			)}

			{!token ? (
				<div class="alert alert-error">Missing reset token. Please request a new reset email.</div>
			) : (
				<form action="/api/auth/reset-password" method="post">
					<input type="hidden" name="token" value={token} />
					<div class="form-group">
						<label class="form-label" for="password">New Password</label>
						<input id="password" name="password" type="password" class="form-input" required minlength="8" autocomplete="new-password" />
					</div>
					<div class="form-group">
						<label class="form-label" for="password2">Confirm New Password</label>
						<input id="password2" name="password2" type="password" class="form-input" required minlength="8" autocomplete="new-password" />
					</div>
					<button type="submit" class="btn btn-primary btn-full btn-lg">Update Password</button>
				</form>
			)}

			<p style="text-align:center; margin-top:1rem;"><a href="/forgot-password">Request another reset link</a></p>
		</div>
	</div>
</BaseLayout>
